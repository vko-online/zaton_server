# Migration `20201013152538-invoice`

This migration has been generated by Medet Tleukabiluly at 10/13/2020, 9:25:38 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Line" (
    "id" TEXT NOT NULL,
    "qty" INTEGER NOT NULL,
    "invoiceId" TEXT NOT NULL,
    "productId" TEXT NOT NULL,

    FOREIGN KEY ("productId") REFERENCES "Product"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("invoiceId") REFERENCES "Invoice"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

CREATE TABLE "Account" (
    "id" TEXT NOT NULL,
    "bin" TEXT NOT NULL,
    "balance" INTEGER,
    "name" TEXT,
    "bankName" TEXT NOT NULL,
    "companyId" TEXT NOT NULL,

    FOREIGN KEY ("companyId") REFERENCES "Company"("id") ON DELETE CASCADE ON UPDATE CASCADE,
PRIMARY KEY ("id")
)

PRAGMA foreign_keys=OFF;
CREATE TABLE "new_Client" (
    "id" TEXT NOT NULL,
    "bin" TEXT,
    "name" TEXT NOT NULL,
    "type" INTEGER,
    "legalAddress" TEXT,
    "actualAddress" TEXT,
    "phone" TEXT,
    "email" TEXT,
    "position" TEXT,
    "director" TEXT,
    "note" TEXT,
    "companyId" TEXT,

    FOREIGN KEY ("companyId") REFERENCES "Company"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
);
INSERT INTO "new_Client" ("id", "bin", "name", "type", "legalAddress", "actualAddress", "phone", "email", "position", "director", "note", "companyId") SELECT "id", "bin", "name", "type", "legalAddress", "actualAddress", "phone", "email", "position", "director", "note", "companyId" FROM "Client";
DROP TABLE "Client";
ALTER TABLE "new_Client" RENAME TO "Client";
CREATE TABLE "new_Invoice" (
    "id" TEXT NOT NULL,
    "num" TEXT,
    "draft" BOOLEAN NOT NULL,
    "date" DATETIME,
    "clientId" TEXT NOT NULL,
    "companyId" TEXT NOT NULL,
    "accountId" TEXT NOT NULL,
    "productId" TEXT,

    FOREIGN KEY ("clientId") REFERENCES "Client"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("companyId") REFERENCES "Company"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("accountId") REFERENCES "Account"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("productId") REFERENCES "Product"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
);
INSERT INTO "new_Invoice" ("id", "num", "draft", "date", "clientId", "companyId") SELECT "id", "num", "draft", "date", "clientId", "companyId" FROM "Invoice";
DROP TABLE "Invoice";
ALTER TABLE "new_Invoice" RENAME TO "Invoice";
CREATE TABLE "new_Product" (
    "id" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "service" BOOLEAN NOT NULL,
    "sku" TEXT,
    "unit" TEXT,
    "price" INTEGER,
    "companyId" TEXT,

    FOREIGN KEY ("companyId") REFERENCES "Company"("id") ON DELETE SET NULL ON UPDATE CASCADE,
PRIMARY KEY ("id")
);
INSERT INTO "new_Product" ("id", "name", "service", "sku", "unit", "price", "companyId") SELECT "id", "name", "service", "sku", "unit", "price", "companyId" FROM "Product";
DROP TABLE "Product";
ALTER TABLE "new_Product" RENAME TO "Product";
PRAGMA foreign_key_check;
PRAGMA foreign_keys=ON

PRAGMA foreign_keys=off;
DROP TABLE "_InvoiceToProduct";
PRAGMA foreign_keys=on
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201012182311-company..20201013152538-invoice
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,42 +21,66 @@
   stamp String
   clients Client[]
   invoices Invoice[]
   products Product[]
+  accounts Account[]
   user User @relation(fields: [userId], references: [id])
   userId String
 }
 model Client {
   id String @default(cuid()) @id
-  bin String
+  bin String?
   name String
-  type Int // 
-  legalAddress String
-  actualAddress String
-  phone String
-  email String
-  position String
-  director String
-  note String
+  type Int? // 
+  legalAddress String?
+  actualAddress String?
+  phone String?
+  email String?
+  position String?
+  director String?
+  note String?
   invoices Invoice[]
 }
 model Product {
   id String @default(cuid()) @id
   name String
   service Boolean
-  sku String
-  unit String
-  price Int
+  sku String?
+  unit String?
+  price Int?
   invoices Invoice[]
 }
 model Invoice {
   id String @default(cuid()) @id
-  num String
+  num String?
   draft Boolean
-  date DateTime
+  date DateTime?
   client Client @relation(fields: [clientId], references: [id])
   clientId String
-  products Product[]
+  company Company @relation(fields: [companyId], references: [id])
+  companyId String
+  productLine Line[]
+  account Account @relation(fields: [accountId], references: [id])
+  accountId String
+}
+
+model Line {
+  id String @default(cuid()) @id
+  product Product
+  qty Int
+  invoice Invoice @relation(fields: [invoiceId], references: [id])
+  invoiceId String
+}
+
+model Account {
+  id String @default(cuid()) @id
+  bin String
+  balance Int?
+  name String?
+  bankName String
+  company Company @relation(fields: [companyId], references: [id])
+  companyId String
+  invoices Invoice[]
 }
```


